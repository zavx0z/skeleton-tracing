<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>skeleton-tracing</title>
    <script type="module">
      await new Promise((res) => import("https://zavx0z.github.io/dev-tools/index.js").then(() => setTimeout(res, 200)))
      await import("./index.js")

      function i18n(param) {
        if (param && typeof param === "object") {
          const current = document.documentElement.lang
          const exist = Object.keys(param)
          return exist.includes(current) ? param[current] : exist.includes("en") ? param["en"] : param[exist[0]]
        } else return ""
      }
      
      async function pathToImageData(imagePath) {
        return new Promise((res, rej) => {
          try {
            const canvas = document.createElement("canvas")
            const ctx = canvas.getContext("2d")
            document.createElement("canvas").getContext("2d")
            const img = new Image()
            img.onload = () => {
              canvas.width = img.width
              canvas.height = img.height
              ctx.drawImage(img, 0, 0)
              const imageData = ctx.getImageData(0, 0, img.width, img.height)
              console.log(imageData)
              res(imageData)
            }
            img.src = imagePath
          } catch (e) {
            rej(JSON.stringify(e))
          }
        })
      }

      const res = await pathToImageData("bin.png")
      console.log("res", res)
      const element = document.querySelector("skeleton-tracing")
      element.subscribe((snapshot) => setTimeout(() => console.log(snapshot), 1000))

      const template = document.querySelector("template")
      template.content.querySelector("h1").innerHTML = i18n(element.name)
      element.parentElement.insertBefore(template.content, element)
    </script>
    <dev-tools mobile></dev-tools>
  </head>
  <body>
    <skeleton-tracing preview src="bin.png"></skeleton-tracing>
  </body>
  <template>
    <h1></h1>
    <img src="bin.png" alt="source image" />
  </template>
</html>
